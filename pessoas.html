<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JR Sistemas | Gerenciamento de pessoas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="./vendor/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="./css/app.css">
</head>

<body class="bg-light d-flex flex-wrap">
    <!-- Sidebar -->
    <aside id="main-sidebar">
        <div>
            <figure class="logo m-0">
                <img src="./img/logo.png" alt="Minha logo" title="Minha logo nova e original">
            </figure>
        </div>
        <ul>
            <li>
                <a href="#" class="d-block">
                    <span class="icon btn"><i class="fas fa-tachometer-alt"></i></span>
                    <span class="text">Home</span>
                </a>
            </li>
            <li>
                <a href="#" class="d-block">
                    <span class="icon btn"><i class="fas fa-user-tie"></i></span>
                    <span class="text">Usuários</span>
                </a>
            </li>
            <li>
                <a href="#" class="d-block">
                    <span class="icon btn"><i class="fas fa-users"></i></span>
                    <span class="text">Pessoas</span>
                </a>
            </li>
            <li>
                <a href="#" class="d-block">
                    <span class="icon btn"><i class="fas fa-building"></i></span>
                    <span class="text">Empresas</span>
                </a>
            </li>
            <li>
                <a href="#" class="d-block">
                    <span class="icon btn"><i class="fas fa-cog"></i></span>
                    <span class="text">Configurações</span>
                </a>
            </li>
        </ul>
    </aside>
    <!-- /Sidebar -->
    <div class="col p-0">
        <!-- NAVBAR -->
        <nav id="main-navbar" class="col-12 p-0 bg-primary-color py-2 pl-3 pr-0 border-bottom">
            <div class="container-fluid d-flex p-0">
                <div></div>
                <div class="col col-sm-0 p-0">
                    <figure class="logo m-0">
                        <img src="./img/logo.png" alt="Minha logo" title="Minha logo nova e original">
                    </figure>
                </div>
                <div class="col-md-3 p-0 d-flex justify-content-end">
                    <ul class="d-flex align-items-center" id="funcoes-secretas">
                        <li>
                            <span class="btn icon"><i class="fas fa-users"></i></span>
                            <span class="text">Gerenciamento de usuários</span>
                        </li>
                        <li class="hide-on-mobile">
                            <span class="btn icon"><i class="fas fa-mobile"></i></span>
                            <span class="text">Mudar de dispositivo</span>
                        </li>
                        <li>
                            <span class="btn icon"><i class="fas fa-cog"></i></span>
                            <span class="text">Configurações</span>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- /NAVBAR -->
        <!-- CONTEUDO -->
        <div id="app" class="container-fluid">
            <div class="container mx-auto">
                <div class="card mx-auto mt-4">
                    <div class="card-header bg-white px-3">
                        <div>
                            <div class="texto-cadastro">
                                <h3>Insira os dados do usuário para cadastro</h3>
                            </div>
                            <div class="texto-edicao" style="display: none;">
                                <h3>Insira os dados do usuário para edição</h3>
                            </div>
                        </div>
                        <div class="row pr-3 campos">
                            <div class="form-group col-md-4">
                                <input type="text" id="name" v-model="cadastro.name" class="form-control" placeholder="Nome da pessoa">
                            </div>
                            <div class="form-group col-md-4">
                                <input type="text" id="document" v-model="cadastro.document" class="form-control" placeholder="Documento">
                            </div>
                            <div class="form-group col-md-3">
                                <input type="date" id="dtBirth" v-model="cadastro.dtBirth" class="form-control">
                            </div>
                            <div class="form-group col-md-3">
                                <input type="text" id="email" v-model="cadastro.email" class="form-control" placeholder="E-mail">
                            </div>
                            <div class="form-group col-md-3">
                                <input type="text" id="phone" v-model="cadastro.phone"  class="form-control" placeholder="Telefone">
                            </div>
                        </div>
                        <div class="col-12 p-0">
                            <div id="botoes-cadastro">
                                <button type="button" onclick="app.save()" class="btn btn-success">Salvar</button>
                            </div>
                            <div id="botoes-editar" style="display: none;">
                                <button type="button" onclick="app.cadastrar()" class="btn btn-danger">Voltar</button>
                                <button type="button" :data-id="cadastro.id" onclick="app.update(this)" class="btn btn-success">Atualizar</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body px-3">
                        <people-list :people="people" />
                    </div>
                </div>
            </div>
        </div>
        <!-- /CONTEUDO -->
    </div>
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@2"></script>
    <script src="./js/providers/person-provider.js"></script>

    <script>
        Vue.component('people-list', {
            props: {
                people: {
                    type: Array,
                    required: true
                },
            },
            template:
                `
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>E-mail</th>
                        <th>Telefone</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="pessoa in people">
                        <td>{{ pessoa.name }}</td>
                        <td>{{ pessoa.email }}</td>
                        <td>{{ pessoa.phone }}</td>
                        <td class="text-right">
                            <button type="button" :data-id="pessoa.id" onclick="app.editar(this)" class="btn btn-success mr-2"><i class="fas fa-edit"></i></button>    
                            <button type="button" :data-id="pessoa.id" onclick="app.deletar(this)" class="btn btn-danger"><i class="fas fa-trash"></i></button>    
                        </td>
                    </tr>
                </tbody>
            </table>`
        })

        var app = new Vue({
            el: '#app',
            data: {
                cadastro: {
                    id: 0,
                    name: '', 
                    dtBirth: '', 
                    document: '', 
                    email: '', 
                    phone: '' 
                },
                people: [
                    { id: 1, name: 'Felipe Cardoso', dtBirth: '', document: '', email: 'felipe.cardoso@gmail.com', phone: '' },
                    { id: 2, name: 'Carlos Viana', dtBirth: '', document: '', email: 'carlos.viana@gmail.com', phone: '' },
                    { id: 3, name: 'Kelly Almeda', dtBirth: '', document: '', email: 'elly.almeida@gmail.com', phone: '' }
                ],
                personProvider: {},
            },
            created() {
                // instância PersonProvider que será utilizado para efetuar as açoes
                this.personProvider = new PersonProvider();
                this.findByParams();
                this.refresh();
            },
            methods: {
                refresh() {
                    this.people = [];
                    const index = this.personProvider.getIndex().data;
                    for(const id in index) {
                        try {
                            this.people.push(JSON.parse(window.localStorage.getItem(index[id])));
                        } catch(exception) {
                            
                        }
                    }
                },
                findByParams() {
                    return this.cadastro;
                },
                save() {
                    this.personProvider.save(this.cadastro);
                    // Limpando o form
                    for(const key in this.cadastro) {
                        this.cadastro[key] = '';
                    }
                    this.refresh();
                },
                cadastrar() {
                    for(const key in this.cadastro) {
                        this.cadastro[key] = '';
                    }
                    $('.texto-cadastro').show();
                    $('.texto-edicao').hide();
                    $('#botoes-cadastro').show();
                    $('#botoes-editar').hide();
                },
                editar(element) {
                    $('.texto-cadastro').hide();
                    $('.texto-edicao').show();
                    $('#botoes-cadastro').hide();
                    $('#botoes-editar').show();
                    let result = this.personProvider.findById($(element).attr('data-id'));
                    for(const key in this.cadastro) {
                        this.cadastro[key] = result[key] ?? '';
                    }
                },
                update(element) {
                    this.personProvider.update($(element).attr('data-id'), this.cadastro);
                    this.cadastrar();
                    this.refresh();
                },
                deletar(element) {
                    this.personProvider.update($(element).attr('data-id'));
                    this.refresh();
                }
            }
        });
    </script>
</body>

</html>